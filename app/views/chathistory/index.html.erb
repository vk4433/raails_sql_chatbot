<h1>SQL Chatbot</h1>

<%= form_with url: chathistory_index_path, method: :post, local: true do |form| %>
  <div class="form-group">
    <%= form.label :query, "Ask a question:" %>
    <%= form.text_field :query, placeholder: "Type your question here", class: "form-control", style: "width: 300px;" %>
  </div>
  <%= form.submit "Submit", class: "btn btn-primary mt-2" %>
<% end %>

<%# Show last executed query %>
<% if flash[:executed_query] %>
  <h2 class="mt-4">Generated SQL Query:</h2>
  <pre><%= flash[:executed_query] %></pre>
<% end %>

<%# Show result table %>
<% if flash[:result] %>
  <h2 class="mt-4">Query Result:</h2>
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <% flash[:result].first&.keys&.each do |column| %>
            <th><%= column.capitalize %></th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% flash[:result].each do |row| %>
          <tr>
            <% row.values.each do |value| %>
              <td><%= value %></td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %> 